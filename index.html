<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title">Solar Colombia | Dashboard de Radiación</title>
    <!-- Security: SRI for external libraries -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --card-dark: #1e293b;
            --accent: #fbbf24;
            --accent-glow: rgba(251, 191, 36, 0.3);
        }
        body {
            background-color: var(--bg-dark);
            font-family: 'Outfit', sans-serif;
            color: #f8fafc;
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }
        .text-gradient {
            background: linear-gradient(135deg, #fbbf24 0%, #f97316 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stats-badge {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(249, 115, 22, 0.1) 100%);
            border: 1px solid rgba(251, 191, 36, 0.2);
        }
        select, button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #map-container {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
<base target="_blank">
</head>
<body class="p-4 md:p-6">
    <div class="max-w-[1600px] mx-auto space-y-6">
        <!-- Premium Header -->
        <header class="flex flex-col md:flex-row items-center justify-between gap-6 pb-2 border-b border-white/10">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-600 rounded-xl flex items-center justify-center shadow-lg shadow-orange-500/20">
                    <i class="fas fa-sun text-white text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-extrabold tracking-tight">
                        <span class="text-white" data-i18n="headerTitle1">Solar</span><span class="text-gradient" data-i18n="headerTitle2">Colombia</span>
                    </h1>
                    <p class="text-slate-400 text-sm font-medium" data-i18n="headerSubtitle">Spatial Radiation Analysis • IDEAM station network</p>
                </div>
            </div>
            
            <div class="flex flex-wrap items-center gap-3">
                <!-- Play Button -->
                <button id="btn-play" onclick="togglePlay()" 
                        class="flex items-center gap-2 px-5 py-2.5 bg-emerald-500/10 hover:bg-emerald-500 text-emerald-400 hover:text-white border border-emerald-500/20 rounded-full font-semibold text-sm transition-all duration-300">
                    <i class="fas fa-play"></i>
                    <span data-i18n="btnPlay">Play Year</span>
                </button>

                <!-- Month Selector -->
                <div class="relative min-w-[180px]">
                    <select id="month-selector" onchange="updateMap(this.value)" 
                            class="w-full bg-slate-800 text-white border border-slate-700 px-4 py-2.5 rounded-full text-sm font-semibold appearance-none cursor-pointer hover:border-slate-500 focus:outline-none focus:ring-2 focus:ring-orange-500/50">
                        <option value="ENE">January</option>
                        <option value="FEB">February</option>
                        <option value="MAR">March</option>
                        <option value="ABR">April</option>
                        <option value="MAY">May</option>
                        <option value="JUN">June</option>
                        <option value="JUL">July</option>
                        <option value="AGO">August</option>
                        <option value="SEP">September</option>
                        <option value="OCT">October</option>
                        <option value="NOV">November</option>
                        <option value="DIC">December</option>
                        <option value="Annual">Annual Average</option>
                    </select>
                    <i class="fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none"></i>
                </div>

                <!-- Toggle Stations -->
                <button id="btn-stations" onclick="toggleStations()" 
                        class="flex items-center gap-2 px-5 py-2.5 bg-slate-800 border border-slate-700 text-slate-300 hover:text-white rounded-full font-semibold text-sm transition-all">
                    <i id="station-icon" class="fas fa-location-dot text-red-500"></i>
                    <span data-i18n="btnStations">Stations</span>
                </button>

                <!-- Language Selector -->
                <div class="relative min-w-[120px]">
                    <select id="lang-selector" onchange="setLanguage(this.value)" 
                            class="w-full bg-slate-800 text-white border border-slate-700 px-4 py-2.5 rounded-full text-sm font-semibold appearance-none cursor-pointer hover:border-slate-500 focus:outline-none focus:ring-2 focus:ring-orange-500/50">
                        <option value="en">English</option>
                        <option value="es">Español</option>
                        <option value="de">Deutsch</option>
                    </select>
                    <i class="fas fa-globe absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none"></i>
                </div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-5 gap-6 h-[calc(100vh-260px)] min-h-[500px]">
            <!-- Map Area -->
            <div class="lg:col-span-4 relative group">
                <div id="map-container" class="w-full h-full bg-slate-900 border border-white/5"></div>
            </div>

            <!-- Dashboard Sidebar -->
            <div class="flex flex-col gap-6">
                <!-- Statistics Card -->
                <section class="glass-card pt-4 px-4 pb-4 flex-1 flex flex-col overflow-hidden">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-bold flex items-center gap-2">
                            <i class="fas fa-chart-line text-orange-500"></i>
                            <span data-i18n="spatialAnalysis">Spatial Analysis</span>
                        </h3>
                    </div>
                    
                    <div id="stats-container" class="space-y-2.5 overflow-y-auto pr-1">
                        <div class="flex justify-center py-12">
                            <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-orange-500"></div>
                        </div>
                    </div>
                </section>

                <!-- Technical Details -->
                <section class="glass-card p-6 min-h-[140px]">
                    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                        <i class="fas fa-microchip"></i>
                        <span data-i18n="methodology">Methodology</span>
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="stats-badge p-3 rounded-xl text-center">
                            <p class="text-slate-400 text-[10px] uppercase font-bold" data-i18n="model">Model</p>
                            <p class="text-white text-xs font-bold mt-1">OK Spherical</p>
                        </div>
                        <div class="stats-badge p-3 rounded-xl text-center">
                            <p class="text-slate-400 text-[10px] uppercase font-bold" data-i18n="grid">Grid</p>
                            <p class="text-white text-xs font-bold mt-1" data-i18n="gridPoints">8,000 Points</p>
                        </div>
                    </div>
                    <p class="text-[10px] text-slate-500 mt-4 leading-relaxed italic" data-i18n="footnote">
                        Values outside the national boundary have been removed using a geographical mask for territorial precision.
                    </p>
                </section>
            </div>
        </main>
    </div>

    <script>
        let currentMonth = 'ENE';
        let stationsVisible = true;
        let playInterval = null;
        let isPlaying = false;
        let currentLang = 'en';
        const monthsOrder = ['ENE', 'FEB', 'MAR', 'ABR', 'MAY', 'JUN', 'JUL', 'AGO', 'SEP', 'OCT', 'NOV', 'DIC', 'Annual'];

        const translations = {
            en: {
                title: "Solar Colombia | Radiation Dashboard",
                headerTitle1: "Solar",
                headerTitle2: "Colombia",
                headerSubtitle: "Spatial Radiation Analysis • IDEAM Station Network",
                btnPlay: "Play Year",
                btnPause: "Pause",
                monthSelector: {
                    ENE: "January", FEB: "February", MAR: "March", ABR: "April",
                    MAY: "May", JUN: "June", JUL: "July", AGO: "August",
                    SEP: "September", OCT: "October", NOV: "November", DIC: "December",
                    Annual: "Annual Average"
                },
                btnStations: "Stations",
                spatialAnalysis: "Spatial Analysis",
                methodology: "Methodology",
                model: "Model",
                grid: "Grid",
                gridPoints: "8,000 Points",
                footnote: "Values outside national boundaries have been removed using a geographical mask for territorial precision.",
                initError: "Initialization Error",
                loadError: "Error loading resources",
                solarPotential: "Solar Potential",
                potentials: {
                    Bajo: "Low", Moderado: "Moderate", Alto: "High", Excelente: "Excellent"
                },
                stats: {
                    average: "Average", maximum: "Maximum", regionalLeader: "Regional Leader",
                    peakValue: "Peak Value", p90Index: "P90 Index (Guarantee)", nationalVariability: "Nat. Variability"
                }
            },
            es: {
                title: "Solar Colombia | Dashboard de Radiación",
                headerTitle1: "Solar",
                headerTitle2: "Colombia",
                headerSubtitle: "Análisis Espacial de Radiación • Red de estaciones IDEAM",
                btnPlay: "Reproducir Año",
                btnPause: "Pausar",
                monthSelector: {
                    ENE: "Enero", FEB: "Febrero", MAR: "Marzo", ABR: "Abril",
                    MAY: "Mayo", JUN: "Junio", JUL: "Julio", AGO: "Agosto",
                    SEP: "Septiembre", OCT: "Octubre", NOV: "Noviembre", DIC: "Diciembre",
                    Annual: "Promedio Anual"
                },
                btnStations: "Estaciones",
                spatialAnalysis: "Análisis Espacial",
                methodology: "Metodología",
                model: "Modelo",
                grid: "Malla",
                gridPoints: "8,000 Puntos",
                footnote: "Los valores fuera del límite nacional han sido removidos mediante máscara geográfica para precisión territorial.",
                initError: "Error de Inicialización",
                loadError: "Error al cargar recursos",
                solarPotential: "Potencial Solar",
                potentials: {
                    Bajo: "Bajo", Moderado: "Moderado", Alto: "Alto", Excelente: "Excelente"
                },
                stats: {
                    average: "Promedio", maximum: "Máximo", regionalLeader: "Líder Regional",
                    peakValue: "Valor Pico", p90Index: "Índice P90 (Garantía)", nationalVariability: "Variabilidad Nac."
                }
            },
            de: {
                title: "Solar Kolumbien | Strahlungs-Dashboard",
                headerTitle1: "Solar",
                headerTitle2: "Kolumbien",
                headerSubtitle: "Räumliche Strahlungsanalyse • IDEAM-Stationsnetz",
                btnPlay: "Jahr abspielen",
                btnPause: "Pause",
                monthSelector: {
                    ENE: "Januar", FEB: "Februar", MAR: "März", ABR: "April",
                    MAY: "Mai", JUN: "Juni", JUL: "Juli", AGO: "August",
                    SEP: "September", OCT: "Oktober", NOV: "November", DIC: "Dezember",
                    Annual: "Jahresdurchschnitt"
                },
                btnStations: "Stationen",
                spatialAnalysis: "Räumliche Analyse",
                methodology: "Methodik",
                model: "Modell",
                grid: "Gitter",
                gridPoints: "8.000 Punkte",
                footnote: "Werte außerhalb der Landesgrenzen wurden mittels geografischer Maskierung für territoriale Präzision entfernt.",
                initError: "Initialisierungsfehler",
                loadError: "Fehler beim Laden der Ressourcen",
                solarPotential: "Solarpotenzial",
                potentials: {
                    Bajo: "Niedrig", Moderado: "Moderat", Alto: "Hoch", Excelente: "Exzellent"
                },
                stats: {
                    average: "Durchschnitt", maximum: "Maximum", regionalLeader: "Regionaler Führer",
                    peakValue: "Spitzenwert", p90Index: "P90-Index (Garantie)", nationalVariability: "Nat. Variabilität"
                }
            }
        };

        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.getElementById('lang-selector').value = lang;
            
            // Update static elements
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    el.innerText = translations[lang][key];
                }
            });

            // Update Page Title
            document.title = translations[lang].title;

            // Update Month Selector
            const selector = document.getElementById('month-selector');
            const currentValue = selector.value;
            selector.innerHTML = '';
            monthsOrder.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.innerText = translations[lang].monthSelector[month];
                selector.appendChild(option);
            });
            selector.value = currentValue;

            // Update Play Button text
            const btnPlay = document.getElementById('btn-play');
            if (isPlaying) {
                btnPlay.querySelector('span').innerText = translations[lang].btnPause;
            } else {
                btnPlay.querySelector('span').innerText = translations[lang].btnPlay;
            }

            // Update current map/stats
            if (window.globalData && window.krigingData) {
                updateMap(currentMonth);
            }
        }

        async function initializeMap() {
            try {
                // Load data
                const [csvRes, krigingRes] = await Promise.all([
                    fetch('radiation_data.csv'),
                    fetch('kriging_data.json')
                ]);
                
                if (!csvRes.ok || !krigingRes.ok) throw new Error(translations[currentLang].loadError);
                
                const csvText = await csvRes.text();
                window.globalData = parseCSV(csvText);
                window.krigingData = await krigingRes.json();
                
                await updateMap('ENE');
            } catch (error) {
                console.error("Init Error:", error);
                document.getElementById('map-container').innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-red-400 p-8 text-center">
                        <i class="fas fa-triangle-exclamation text-4xl mb-4"></i>
                        <p class="font-bold">${translations[currentLang].initError}</p>
                        <p class="text-xs opacity-60 mt-2">${error.message}</p>
                    </div>`;
            }
        }

        // Security: Function to escape HTML and prevent XSS
        function escapeHTML(str) {
            if (typeof str !== 'string') return str;
            return str.replace(/[&<>"']/g, m => ({
                '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
            }[m]));
        }

        function parseCSV(csv) {
            const lines = csv.split('\n').map(l => l.trim()).filter(l => l);
            if (lines.length < 2) return [];

            // Regex to split by commas respecting content between quotes
            const splitMapped = (line) => {
                const result = [];
                let current = '';
                let inQuotes = false;
                for (let char of line) {
                    if (char === '"') inQuotes = !inQuotes;
                    else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else current += char;
                }
                result.push(current.trim());
                return result;
            };

            const headers = splitMapped(lines[0]);
            const result = [];
            
            for(let i = 1; i < lines.length; i++) {
                const row = splitMapped(lines[i]);
                if (row.length < headers.length) continue;

                const entry = {};
                headers.forEach((header, index) => {
                    let val = row[index];
                    if (['Latitud', 'Longitud', 'ENE', 'FEB', 'MAR', 'ABR', 'MAY', 'JUN', 'JUL', 'AGO', 'SEP', 'OCT', 'NOV', 'DIC', 'Annual_Average'].includes(header)) {
                        entry[header] = parseFloat(val.replace(',', '.'));
                    } else {
                        entry[header] = escapeHTML(val);
                    }
                });

                result.push({
                    name: entry['Estacion'] || 'Unnamed',
                    dept: entry['Departamento'] || 'N/A',
                    lat: entry['Latitud'],
                    lon: entry['Longitud'],
                    ENE: entry['ENE'], FEB: entry['FEB'], MAR: entry['MAR'], ABR: entry['ABR'],
                    MAY: entry['MAY'], JUN: entry['JUN'], JUL: entry['JUL'], AGO: entry['AGO'],
                    SEP: entry['SEP'], OCT: entry['OCT'], NOV: entry['NOV'], DIC: entry['DIC'],
                    Annual: entry['Annual_Average']
                });
            }
            return result;
        }

        async function updateMap(month) {
            currentMonth = month;
            const selector = document.getElementById('month-selector');
            if (selector) selector.value = month;

            const dataKey = (month === 'Annual') ? 'Annual_Average' : month;
            const stations = window.globalData;
            const monthValues = stations.map(s => s[month]).filter(v => !isNaN(v));
            
            // Fixed scale lines for temporal consistency
            const globalMin = 1.5;
            const globalMax = 6.5;

            // Re-process the Kriging grid for this visualization
            const flatLats = [], flatLons = [], flatZ = [];
            const krigingZ = window.krigingData.data[dataKey];
            
            if (krigingZ) {
                for (let i = 0; i < window.krigingData.lat.length; i++) {
                    for (let j = 0; j < window.krigingData.lon.length; j++) {
                        const val = krigingZ[i][j];
                        if (val !== null && val !== undefined) {
                            flatLats.push(window.krigingData.lat[i]);
                            flatLons.push(window.krigingData.lon[j]);
                            flatZ.push(val);
                        }
                    }
                }
            }

            const krigingTrace = {
                type: 'densitymapbox',
                lat: flatLats,
                lon: flatLons,
                z: flatZ,
                radius: 10, // Midpoint to avoid saturation and gaps
                colorscale: 'Jet',
                zmin: globalMin,
                zmax: globalMax,
                opacity: 0.6,
                showscale: false,
                hoverinfo: 'none'
            };

            const stationsTrace = {
                type: 'scattermapbox',
                lat: stations.map(s => s.lat), 
                lon: stations.map(s => s.lon),
                mode: 'markers',
                marker: {
                    size: 8,
                    color: stations.map(s => s[month]),
                    colorscale: 'Jet',
                    cmin: globalMin, cmax: globalMax,
                    showscale: true,
                    line: { color: 'white', width: 1 },
                    colorbar: {
                        thickness: 15,
                        len: 0.5,
                        title: { text: 'kWh/m²', font: { color: '#94a3b8' } },
                        tickfont: { color: '#94a3b8' }
                    }
                },
                text: stations.map(s => `<b>${s.name}</b><br>${s[month].toFixed(2)} kWh/m²`),
                hoverinfo: 'text',
                visible: stationsVisible
            };

            const layout = {
                mapbox: {
                    style: 'carto-darkmatter', // Dark Premium Style
                    center: { lat: 4.5, lon: -73.5 }, // Centered perspective
                    zoom: 4.0 // Holistic view
                },
                margin: { t: 0, b: 0, l: 0, r: 0 },
                showlegend: false,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            if (flatZ.length > 0) {
                // Performance: Plotly.react updates only changes, avoiding DOM recreation
                Plotly.react('map-container', [krigingTrace, stationsTrace], layout, { responsive: true, displayModeBar: false });
                // Real Spatial Analysis: We use the grid (flatZ) instead of just stations
                updateStats(flatZ, month);
            } else {
                console.warn("No data for month:", month);
            }
        }

        function updateStats(values, month) {
            if (!values || values.length === 0) return;

            // 1. Geospatial Statistics over the total surface
            values.sort((a, b) => a - b);
            const mean = values.reduce((a, b) => a + b, 0) / values.length;
            const max = values[values.length - 1];
            const min = values[0];
            
            // Real P90: Value that 90% of the territory exceeds (10th Percentile)
            const p90 = values[Math.floor(values.length * 0.1)];
            
            // Official IDEAM/UPME thresholds for Colombia
            if (mean > 5.5) { 
                potentialKey = 'Excelente'; color = 'text-emerald-400'; bg = 'bg-emerald-500/10'; 
            } else if (mean > 4.5) { 
                potentialKey = 'Alto'; color = 'text-orange-400'; bg = 'bg-orange-500/10'; 
            } else if (mean > 3.5) { 
                potentialKey = 'Moderado'; color = 'text-yellow-400'; bg = 'bg-yellow-500/10'; 
            } else {
                potentialKey = 'Bajo'; color = 'text-red-400'; bg = 'bg-red-500/10';
            }
            
            const potentialTranslated = translations[currentLang].potentials[potentialKey];

            // 2. Regional Leader (Department with the highest peak value)
            let maxStationVal = -1;
            let leaderDept = 'N/A';
            
            window.globalData.forEach(s => {
                const val = s[month];
                if (!isNaN(val) && val > maxStationVal) {
                    maxStationVal = val;
                    leaderDept = s.dept;
                }
            });

            const leader = { name: leaderDept, val: maxStationVal };
            const t = translations[currentLang].stats;

            // 3. Panel Rendering
            document.getElementById('stats-container').innerHTML = `
                <!-- Potential Badge -->
                <div class="${bg} p-2.5 rounded-xl mb-2 border border-white/5 text-center transition-all">
                    <p class="text-[10px] uppercase font-bold text-slate-400 mb-0.5 tracking-widest">${translations[currentLang].solarPotential}</p>
                    <p class="text-lg font-black ${color}">${potentialTranslated}</p>
                </div>
                
                <!-- Main KPIs -->
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <div class="bg-white/5 p-2 rounded-xl border border-white/5 text-center">
                        <p class="text-[9px] text-slate-400 uppercase font-bold tracking-tighter">${t.average}</p>
                        <p class="text-sm font-bold text-white">${mean.toFixed(2)}</p>
                    </div>
                    <div class="bg-white/5 p-2 rounded-xl border border-white/5 text-center">
                        <p class="text-[9px] text-slate-400 uppercase font-bold tracking-tighter">${t.maximum}</p>
                        <p class="text-sm font-bold text-white">${max.toFixed(2)}</p>
                    </div>
                </div>

                <!-- Departmental Leader -->
                <div class="mb-2">
                    <h4 class="text-[9px] uppercase font-bold text-slate-500 mb-2 tracking-widest flex items-center gap-2">
                        <i class="fas fa-crown text-yellow-500 text-[8px]"></i> ${t.regionalLeader}
                    </h4>
                    <div class="p-2 bg-gradient-to-br from-white/10 to-transparent rounded-xl border border-white/10 flex items-center justify-between">
                        <div class="flex flex-col">
                            <span class="text-[12px] font-bold text-white tracking-tight">${leader.name}</span>
                            <span class="text-[8px] uppercase font-bold text-slate-500">${t.peakValue}</span>
                        </div>
                        <div class="text-right">
                            <span class="text-base font-black text-orange-400">${leader.val.toFixed(2)}</span>
                            <span class="text-[8px] block font-bold text-slate-500">kWh/m²</span>
                        </div>
                    </div>
                </div>

                <!-- Efficiency and Quality -->
                <div class="space-y-2 pt-1 border-t border-white/5">
                    <div class="flex justify-between items-center text-[9px]">
                        <span class="text-slate-400 uppercase font-bold text-[9px]">${t.p90Index}</span>
                        <span class="font-bold text-emerald-400">${p90.toFixed(2)}</span>
                    </div>
                    <div class="w-full h-1 bg-slate-800 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-emerald-600 to-emerald-400" style="width: ${(p90/7*100).toFixed(0)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center text-[9px]">
                        <span class="text-slate-400 uppercase font-bold text-[9px]">${t.nationalVariability}</span>
                        <span class="font-bold text-orange-400">${(max-min).toFixed(2)}</span>
                    </div>
                </div>
            `;
        }

        function togglePlay() {
            const btn = document.getElementById('btn-play');
            isPlaying = !isPlaying;
            if (isPlaying) {
                btn.classList.add('bg-red-500/10', 'border-red-500/20', 'text-red-400');
                btn.classList.remove('bg-emerald-500/10', 'border-emerald-500/20', 'text-emerald-400');
                btn.innerHTML = `<i class="fas fa-pause"></i><span>${translations[currentLang].btnPause}</span>`;
                playInterval = setInterval(() => {
                    let next = (monthsOrder.indexOf(currentMonth) + 1) % 12;
                    updateMap(monthsOrder[next]);
                }, 1500);
            } else {
                clearInterval(playInterval);
                btn.classList.remove('bg-red-500/10', 'border-red-500/20', 'text-red-400');
                btn.classList.add('bg-emerald-500/10', 'border-emerald-500/20', 'text-emerald-400');
                btn.innerHTML = `<i class="fas fa-play"></i><span>${translations[currentLang].btnPlay}</span>`;
            }
        }

        function toggleStations() {
            stationsVisible = !stationsVisible;
            const icon = document.getElementById('station-icon');
            icon.className = stationsVisible ? 'fas fa-location-dot text-red-500' : 'fas fa-location-dot text-slate-500';
            updateMap(currentMonth);
        }

        document.addEventListener('DOMContentLoaded', () => {
            setLanguage('en');
            initializeMap();
        });
    </script>
</body>
</html>